<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png" />
    <link rel="icon" type="image/png" href="../assets/img/favicon.png" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>ESALES</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
    <!-- Bootstrap core CSS     -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
    <!--  Material Dashboard CSS    -->
    <link href="../assets/css/material-dashboard.css?v=1.2.0" rel="stylesheet" />
    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="../assets/css/demo.css" rel="stylesheet" />
    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300|Material+Icons' rel='stylesheet' type='text/css'>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker.min.css" rel="stylesheet" />
    
    <link href="../assets/css/amadeus.css" rel="stylesheet" />
</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-color="blue" data-image="../assets/img/sidebar-1.jpg">
            <!--
            Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

            Tip 2: you can also add an image using data-image tag
            -->
            <div class="logo">
                <a href="#" class="simple-text">
                    ESALES
                </a>
            </div>
            <div class="sidebar-wrapper">
                <ul class="nav">
                    <li class="active">
                        <a href="./availability">
                            <i class="material-icons">dashboard</i>
                            <p>Flights Availability</p>
                        </a>
                    </li>
                    <li class="active">
                        <a href="./record">
                            <i class="material-icons">list</i>
                            <p>PNR Records</p>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
        <div class="main-panel">
            <nav class="navbar navbar-transparent navbar-absolute">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="#"> Table List </a>
                    </div>
                    <div class="collapse navbar-collapse">
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <a href="#pablo" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="material-icons">dashboard</i>
                                    <p class="hidden-lg hidden-md">Dashboard</p>
                                </a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="material-icons">notifications</i>
                                    <span class="notification">5</span>
                                    <p class="hidden-lg hidden-md">Notifications</p>
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="#">Mike John responded to your email</a>
                                    </li>
                                    <li>
                                        <a href="#">You have 5 new tasks</a>
                                    </li>
                                    <li>
                                        <a href="#">You're now friend with Andrew</a>
                                    </li>
                                    <li>
                                        <a href="#">Another Notification</a>
                                    </li>
                                    <li>
                                        <a href="#">Another One</a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <a href="#pablo" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="material-icons">person</i>
                                    <p class="hidden-lg hidden-md">Profile</p>
                                </a>
                            </li>
                        </ul>
                        <form class="navbar-form navbar-right" role="search">
                            <div class="form-group  is-empty">
                                <input type="text" class="form-control" placeholder="Search">
                                <span class="material-input"></span>
                            </div>
                            <button type="submit" class="btn btn-white btn-round btn-just-icon">
                                <i class="material-icons">search</i>
                                <div class="ripple-container"></div>
                            </button>
                        </form>
                    </div>
                </div>
            </nav>
            <div class="content">
                <div class="container-fluid">

                    <div class="col-md-12 alert queue-container" style="min-height: 177px;">
                        <div class="col-md-2 pull-left">
                            <button type="submit" id="btnBook" class="btn btn-lg pull-left" style="background-color: #26a69a; width: 187px; display:none; " data-toggle="modal" data-target=".mdlBook"><i class="material-icons ">play_arrow</i> BOOK FLIGHTS </button> 
                            <button type="submit" id="btnSell" class="btn btn-lg pull-left" style="background-color: #26a69a; width: 187px; display:none;  " ><i class="material-icons ">play_arrow</i> SELL FLIGHTS </button> 
                        </div>
                        <center id="queue-banner" >
                            

                            
                        </center>
                        
                    </div>
                    
                    
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header" data-background-color="blue">
                                <h4 class="title">Search Flight</h4> 
                            </div>
                            <div class="card-content">
                                <form>   
                                    <div class="col-md-12" style="padding-left: 5px !important">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">Origin</label>
                                            <input type="text" id="txtOrigin" class="form-control">
                                        <span class="material-input"></span></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">Destination</label>
                                            <input type="text" id="txtDestination" class="form-control">
                                        <span class="material-input"></span></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">Departure Date</label>
                                            <input type="text" id="txtDepartureDate" class="form-control datepicker" >
                                        <span class="material-input"></span></div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">Arrival Date</label>
                                            <input type="text" id="txtArrivalDate" class="form-control datepicker">
                                        <span class="material-input"></span></div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-info pull-right">SEARCH</button>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                    </div>


                    <span id="showResults">
                        
                    </span>



                </div>
            </div>
        </div>
    </div>

    <div class="modal fade mdlBook" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="col-md-10 col-md-offset-1">
                        <div class="card">
                            <div class="card-header" data-background-color="blue">
                                <h4 class="title">Add Passenger</h4> 
                            </div>
                            <div id="lblPassengers" class="col-md-12 invi">

                                <br><br>
                                <span >Passengers<span style="color:#9e9e9e">(click passenger to remove)</span> :</span> <br>
                                <span id="insert_passengers">
                                    
                                </span>
                            </div>
                            <div class="card-content">
                                   
                                    <div class="col-md-12" style="padding-left: 5px !important">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label ">First Name</label>
                                            <input type="text" id="txtFname" class="mdltxts form-control txtpsnger">
                                        <span class="material-input"></span></div>
                                    </div>

                                    <div class="col-md-12" style="padding-left: 5px !important">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">Last Name</label>
                                            <input type="text" id="txtLname" class="mdltxts form-control txtpsnger">
                                        <span class="material-input"></span></div>
                                    </div>
                                    <div class="col-md-12" style="padding-left: 5px !important">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">Mobile Number</label>
                                            <input type="text" id="txtMnumber" class="mdltxts form-control txtpsnger">
                                        <span class="material-input"></span></div>
                                    </div>
                                    <div class="col-md-12" style="padding-left: 5px !important">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">Email</label>
                                            <input type="text" id="txtEmail" class="mdltxts form-control txtpsnger">
                                        <span class="material-input"></span></div>
                                    </div>
                                    
                                    <button type="submit" id="btnSubmitPassenger" class="btn btn-info pull-right">Submit</button>
                                    <button type="submit" id="btnAddPassenger" style="display:none;" class="btn btn-info pull-right">Add Passenger</button>
                                    
                                    <div class="clearfix"></div>
                               
                            </div>
                        </div>
                    </div>
            </div>
        </div>
    </div>
</body>
<!--   Core JS Files   -->
<script src="../assets/js/jquery-3.2.1.min.js" type="text/javascript"></script>
<script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../assets/js/material.min.js" type="text/javascript"></script>
<!--  Charts Plugin -->
<script src="../assets/js/chartist.min.js"></script>
<!--  Dynamic Elements plugin -->
<script src="../assets/js/arrive.min.js"></script>
<!--  PerfectScrollbar Library -->
<script src="../assets/js/perfect-scrollbar.jquery.min.js"></script>
<!--  Notifications Plugin    -->
<script src="../assets/js/bootstrap-notify.js"></script>
<!-- Material Dashboard javascript methods -->
<script src="../assets/js/material-dashboard.js?v=1.2.0"></script>
<!-- Material Dashboard DEMO methods, don't include it in your project! -->
<script src="../assets/js/demo.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js"></script>

<script type="text/javascript">


    

    $( document ).ready(function() {

        $('#txtDepartureDate').datepicker({
            format: 'yyyy-mm-dd',
            startDate: '0d'
        });

        $('#txtArrivalDate').datepicker({
            format: 'yyyy-mm-dd',
            startDate: '0d'
        });

        // $('#txtDepartureDate').datepicker().on('changeDate', function (selected) {
        //     var minDate = new Date(selected.date.valueOf());
        //     $('#txtArrivalDate').datepicker('startDate', new Date($('#txtDepartureDate').val()));
        //     alert(minDate);
        // });

        var passengerID = 0;
        var flightID = 0;

        $('form').submit(function( event ) {
            
            event.preventDefault(); 

            $.ajax({
                url:"./availability",
                type:"POST",
                data:{
                    departure_date: $('#txtDepartureDate').val()  || '',
                    from: $('#txtOrigin').val() || '',
                    to: $('#txtDestination').val()  || '',
                    arrival_date : $('#txtArrivalDate').val()  || '',
                },
                contentType:"application/x-www-form-urlencoded; charset=UTF-8",
                dataType:"json",
                success: function(response, status){
                    $('#showResults').empty();
                    $('#eachClass').empty();
                    var i = 0 
                    response.availableFlights.forEach(function(flight){ 
                        i++;
                        $('#showResults').append(
                            '<div class="col-md-3 col-sm-4 " data-toggle="modal" data-target=".modal' + i + '" style="cursor: pointer">' +
                                '<div class="card alert alert-info">' +
                                    '<div class="col-md-6 text-center">' +
                                        '<h3>' + flight.flightDetails.departure.location + '</h3>' +
                                        '<h4>' + flight.flightDetails.departure.date + ' | ' + flight.flightDetails.departure.time + '</h4>' +
                                    '</div>' +
                                    '<div class="col-md-6 text-center">' +
                                        '<h3>' + flight.flightDetails.arrival.location + '</h3>' +
                                        '<h4>' + flight.flightDetails.arrival.date + ' | ' + flight.flightDetails.arrival.time + '</h4>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +

                            '<div class="modal modal' + i + '" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabe' + i + '" >' +
                                '<div class="modal-dialog modal-lg" role="document" style="margin-top: 15px !important;">' +
                                    '<div class="modal-content ">' +
                                        '<div class="col-md-12 col-sm-12 ">' +
                                            '<div class="card modal-bottom-pad">' +
                                                '<div class="row">' +
                                                    '<div class="col-md-12 text-center">' +
                                                        '<h3>' + flight.flightDetails.flightNumber + '</h3>' +
                                                        '<h4>Flight Number</h4>' +
                                                    '</div>' +
                                                    '<div class="col-md-3 text-center">' +
                                                        '<h3>' +flight.flightDetails.departure.location + '</h3>' +
                                                        '<h4>' + flight.flightDetails.departure.date + ' | ' + flight.flightDetails.departure.time + '</h4>' +
                                                    '</div>' +
                                                    '<div class="col-md-3 text-center">' +
                                                        '<h3>' + flight.flightDetails.arrival.location + '</h3>' +
                                                        '<h4>' + flight.flightDetails.arrival.date + ' | ' + flight.flightDetails.arrival.time + '</h4>' +
                                                    '</div>' +
                                                    '<div class="col-md-3 text-center">' +
                                                        '<h3>' + flight.flightDetails.carrierCode + '</h3>' +
                                                        '<h4>Carrier Code</h4>' +
                                                    '</div>' +
                                                    '<div class="col-md-3 text-center">' +
                                                        '<h3>' +flight.flightDetails.equipmentType  + '</h3>' +
                                                        '<h4>Equipment Type</h4>' +
                                                    '</div>' +
                                                    '<div class="col-md-3 text-center">' +
                                                        '<h3>' + flight.lineItemNumber + '</h3>' +
                                                        '<h4>Line Item Number</h4>' +
                                                    '</div>' +
                                                    '<div class="col-md-3 text-center">' +
                                                        '<h3>' + flight.stops + '</h3>' +
                                                        '<h4>Stops</h4>' +
                                                    '</div>' +
                                                    '<div class="col-md-3 text-center">' +
                                                        '<h3>' + flight.productClass + '</h3>' +
                                                        '<h4>Product Class</h4>' +
                                                    '</div>' +
                                                    '<br>' +
                                                    '<div class="col-md-12 text-center">' +
                                                        '<h3> Available Classes :</h3>' +
                                                    '</div>' +

                                                    '<span id="eachClass' + i + '"></span>' +
                                                '</div>' +
                                            '</div>' +
                                        '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>'

                        
                            
                            
                        );
                        
                        flight.classes.forEach(function(eachClass){
                            $('#eachClass' + i).append(

                                    '<div class=" col-md-3 text-center classes-card">' +
                                        '<div class="alert alert-info class-card-id">' +
                                            '<span class="get-flight-number" style="display:none;">' + flight.flightDetails.flightNumber + '</span>' +
                                            '<span class="get-flight-date" style="display:none;">' + flight.flightDetails.departure.date + '</span>' +
                                            '<span class="get-flight-departure" style="display:none;">' + flight.flightDetails.departure.location + '</span>' +
                                            '<span class="get-flight-arrival" style="display:none;">' + flight.flightDetails.arrival.location + '</span>' +
                                            '<span class="get-flight-time" style="display:none;">' + flight.flightDetails.departure.time + '</span>' +
                                            '<span class="get-flight-ITR-origin" style="display:none;">' + response.queryDetails.origin + '</span>' +
                                            '<span class="get-flight-ITR-destination" style="display:none;">' + response.queryDetails.destination + '</span>' +
                                            '<h4 class="flight-class">Class: ' + eachClass.class + '</h4>' +
                                            '<h4>Availability: ' + eachClass.availableCount + '</h4>' +
                                        '</div>' +
                                    '</div>' 
                                
                            );
                        });
                        

            
                    });


                    $(".class-card-id").click(function(){
                        flightID = flightID + 1;
                        var toIdentify = $(this).children('.get-flight-number').text() + '(' + $(this).children('.flight-class').text().substring(7) + ')';

                        var isRepeat = false;
                        $('.eachFlightIdentifier').each(function(i, obj) {

                            if($(this).text() == toIdentify){
                                alert('Class is already selected');
                                isRepeat = true;
                                return false;
                            }
                        });

                        if(!isRepeat){
                            $('#btnBook').show();  
                            $('#btnSell').show();  
                                              
                            var flightDetails = {
                                flightClass  : $(this).children('.flight-class').text().substring(7),
                                flightNumber : $(this).children('.get-flight-number').text(),
                                flightdate: $(this).children('.get-flight-date').text(),
                                flightdeparture : $(this).children('.get-flight-departure').text(),
                                flightarrival : $(this).children('.get-flight-arrival').text(),
                            };

                            
                            $('#queue-banner').append(

                                '<div class="col-md-2 eachFlight" id="flight' + flightID + '">' +
                                    '<div class="alert text-center flight-queue eachSegments" id="thisSegment' + flightID + '">' +
                                        '<button type="button" aria-hidden="true" class="close btnRemoveFlight" id="flightRmvBtn' + flightID + '" style="color:black">×</button>' +
                                        '<br>' +
                                        '<p class="queue-destination-text">' + $(this).children('.get-flight-departure').text() +' <i class="material-icons">airplanemode_active</i> ' + $(this).children('.get-flight-arrival').text() + '</p>' +
                                        '<h3 class="queue-number-text eachFlightIdentifier">' + $(this).children('.get-flight-number').text() + '('+ $(this).children('.flight-class').text().substring(7) +')</h3>' +
                                        '<span id="get-segment-number' + flightID + '" style="display:none;">' + $(this).children('.get-flight-number').text() + '</span>' +
                                        '<span id="get-segment-date' + flightID + '" style="display:none;">' + $(this).children('.get-flight-date').text() + '</span>' +
                                        '<span id="get-segment-departure' + flightID + '" style="display:none;">' + $(this).children('.get-flight-departure').text() + '</span>' +
                                        '<span id="get-segment-arrival' + flightID + '" style="display:none;">' + $(this).children('.get-flight-arrival').text() + '</span>' +
                                        '<span id="get-segment-class' + flightID + '" style="display:none;">' + $(this).children('.flight-class').text().substring(7) + '</span>' +
                                        '<span id="get-segment-time' + flightID + '" style="display:none;">' + $(this).children('.get-flight-time').text() + '</span>' +
                                        '<span id="get-flight-ITR-origin' + flightID + '" style="display:none;">' + $(this).children('.get-flight-ITR-origin').text() + '</span>' +
                                        '<span id="get-flight-ITR-destination' + flightID + '" style="display:none;">' + $(this).children('.get-flight-ITR-destination').text() + '</span>' +
                                    '</div>' +
                                '</div>'
                                
                            );

                            $("#flightRmvBtn" + flightID).click(function(){
                                var first_div = $(this).parent();
                                var main_div = $(first_div).parent();

                                var confirmation = confirm("Delete this flight?");

                                if(confirmation){
                                    
                                    $(main_div).remove();
                                    if($('.eachFlight').length == 0){
                                        $('#btnBook').hide();
                                        $('#btnSell').hide()
                                    }
                                }
                                
                                
                            });
                        }
                    });

                    

                }
            })
            
        });

        $("#btnBook").click(function(){
            // $('.flight-queue').each(function() {
            //     alert('get array' );
            // });
        });

        $("#btnSell").click(function(){


            var sellSegment = [];
            var sellSegmentCtr = 0;
            $('.eachSegments').each(function(i, obj) {
                var thisIdSegment = $(this).attr("id").substring(11);
                originalDate = $(this).children('#get-segment-date' + thisIdSegment).text();
                sellSegment[sellSegmentCtr] = {
                    "date": moment(originalDate, 'DDMMYY').format('YYYY-MM-DD'), 

                    "cityCode": "CGY", 

                    "freeText": "", 

                    "origin": $(this).children('#get-segment-departure' + thisIdSegment).text(), 

                    "destination": $(this).children('#get-segment-arrival' + thisIdSegment).text(), 

                    "flightNumber": $(this).children('#get-segment-number' + thisIdSegment).text() , 

                    "bookingClass": $(this).children('#get-segment-class' + thisIdSegment).text(), 

                    "company": "1A", 

                    "type": ""

                }

                sellSegmentCtr = sellSegmentCtr + 1;
            });

            $.ajax({
                url:"./recommendation",
                type:"POST",
                data:{
                    segments: sellSegment || ''
                },
                contentType:"application/x-www-form-urlencoded; charset=UTF-8",
                statusCode: {
                    200: function (response) {
                        alert(response);
                    }
                }
            })


        });

        

        // $("#btnAddPassenger").click(function(){
        //     $('#lblPassengers').show();
        //     if($('#txtFname').val() == "" || $('#txtLname').val() == "") {
        //         alert('First Name, Last Name and one of the contact fields are required.');
        //     }else if($('#txtMnumber').val() != "" || $('#txtEmail').val() != ""){
        //         passengerID = passengerID + 1;
        //         $('#insert_passengers').append(
        //             '<div class="eachPassenger" id="passenger' + passengerID + '" style="clear:both; display:inline-block; margin-right:10px; cursor:pointer" >' +
        //                 '<h3><span class="label label-info">' + $('#txtFname').val() + ' ' + $('#txtLname').val() + '</span></h3>' +
        //                 '<span id="getFname' + passengerID + '" style="display:none;">' + $('#txtFname').val() + '</span>' +
        //                 '<span id="getLname' + passengerID + '" style="display:none;">' + $('#txtLname').val() + '</span>' +
        //                 '<span id="getMnumber' + passengerID + '" style="display:none;">' + $('#txtMnumber').val() + '</span>' +
        //                 '<span id="getEmail' + passengerID + '" style="display:none;">' + $('#txtEmail').val() + '</span>' +
        //             '</div>'
        //         );
        //         $('.txtpsnger').val('');
        //     }else{
        //         alert('First Name, Last Name and one of the contact fields are required.');
        //     }

        //     $("#passenger" + passengerID).click(function(){
        //         var confirmation = confirm("Remove this passenger?");

        //         if(confirmation){
        //             $(this).remove();
        //             if($('.eachPassenger').length == 0){
        //                 $('#lblPassengers').hide();
        //             }
        //         }
        //     });
        // });

        $('#btnSubmitPassenger').click(function(){

            if($('#txtFname').val() == "" || $('#txtLname').val() == "") {
                alert('First Name, Last Name and one of the contact fields are required.');
            }else if($('#txtMnumber').val() != "" || $('#txtEmail').val() != ""){
                // if($('#txtFname').val() != "" || $('#txtLname').val() != "") {
                //     $("#btnAddPassenger").click();
                // }
                
                var passengers = [];
                var contacts = [];
                var segments = [];
                // var passsengerCTR = 0;
                // var contactCTR = 0;
                var segmentCTR = 0;
                var segmentReset = 0;
                var itineraries = [];
                var eachItinerary = {};
                // $('.eachPassenger').each(function(i, obj) {
                //     i = i + 1;
                //     var thisId = $(this).attr("id").substring(9);
                //     alert(thisId);
                //     passengers[passsengerCTR] = { 

                //         "number": i, 

                //         "firstName": $(this).children('#getFname' + i).text(), 

                //         "lastName": $(this).children('#getLname' + i).text()

                //     };

                //     if($(this).children('#getMnumber' + i).text() != ""){
                //         contacts[contactCTR] = {

                //           "type": "mobile",

                //           "value": $(this).children('#getMnumber' + i).text()

                //         };
                //         contactCTR = contactCTR + 1;
                //     }
                    

                //     if($(this).children('#getEmail' + i).text() != ""){
                //         contacts[contactCTR] = {

                //           "type": "email",

                //           "value": $(this).children('#getEmail' + i).text()

                //         };
                //         contactCTR = contactCTR + 1;
                //     }

                //     passsengerCTR = passsengerCTR + 1;
                // });

                passengers[0] = { 

                    "number": 1, 

                    "firstName": $('#txtFname').val(), 

                    "lastName": $('#txtLname').val()

                };

                if($('#txtMnumber').val() != "") {
                    var eachContact = {
                        "type": "mobile",
                        "value": $('#txtMnumber').val()
                    };
                    contacts.push(eachContact);
                    eachContact = {};
                }

                if($('#txtEmail').val() != "") {
                    var eachContact = {
                        "type": "email",
                        "value": $('#txtEmail').val()
                    };
                    contacts.push(eachContact);
                    eachContact = {};
                }


                var previousItineraryOrigin = "";
                var previousItineraryDestination = "";
                var isNewItinerary = false;
                var totalSegments = $('.eachSegments').length;

                $('.eachSegments').each(function(i, obj) {
                    var thisIdSegment = $(this).attr("id").substring(11);
                    if(previousItineraryOrigin == "" || previousItineraryOrigin == $(this).children('#get-flight-ITR-origin' + thisIdSegment).text()){

                        if(previousItineraryDestination == "" || previousItineraryDestination == $(this).children('#get-flight-ITR-destination' + thisIdSegment).text()){
                            previousItineraryOrigin = $(this).children('#get-flight-ITR-origin' + thisIdSegment).text();
                            previousItineraryDestination = $(this).children('#get-flight-ITR-destination' + thisIdSegment).text();
                        }else{
                            isNewItinerary = true;
                            
 
                        }

                    }else{
                        isNewItinerary = true;
                        

                    }
                    
                    if(isNewItinerary){
                        eachItinerary = {
                            origin      : previousItineraryOrigin,
                            destination : previousItineraryDestination,
                            segments    : segments
                        };
                        segments = [];
                        segmentReset = 0;
                        itineraries.push(eachItinerary);
                        eachItinerary = {};
                        isNewItinerary = false;
                        previousItineraryOrigin = $(this).children('#get-flight-ITR-origin' + thisIdSegment).text();
                        previousItineraryDestination = $(this).children('#get-flight-ITR-destination' + thisIdSegment).text();
                    }

                    
                    originalDate = $(this).children('#get-segment-date' + thisIdSegment).text() + ' ' + $(this).children('#get-segment-time' + thisIdSegment).text();
                    segments[segmentReset] = {
                        "date": originalDate, 

                        "cityCode": "CGY", 

                        "freeText": "", 

                        "origin": $(this).children('#get-segment-departure' + thisIdSegment).text(), 

                        "destination": $(this).children('#get-segment-arrival' + thisIdSegment).text(), 

                        "flightNumber": $(this).children('#get-segment-number' + thisIdSegment).text() , 

                        "bookingClass": $(this).children('#get-segment-class' + thisIdSegment).text(), 

                        "company": "5J", 

                        "type": "air"

                    }

                    segmentReset = segmentReset + 1;
                    segmentCTR = segmentCTR + 1;
                    if(segmentCTR == totalSegments){
                        eachItinerary = {
                            origin      : $(this).children('#get-flight-ITR-origin' + thisIdSegment).text(),
                            destination : $(this).children('#get-flight-ITR-destination' + thisIdSegment).text(),
                            segments    : segments
                        };
                        segments = [];
                        segmentReset = 0;
                        itineraries.push(eachItinerary);
                        eachItinerary = {};
                        isNewItinerary = false;
                        previousItineraryOrigin = $(this).children('#get-flight-ITR-origin' + thisIdSegment).text();
                        previousItineraryDestination = $(this).children('#get-flight-ITR-destination' + thisIdSegment).text();
                    }

                });


                $.ajax({
                    url:"./segments",
                    type:"POST",
                    data:{
                        itineraries: itineraries || ''
                    },
                    contentType:"application/x-www-form-urlencoded; charset=UTF-8",
                    dataType:"json",
                    statusCode: {
                        200: function (response) {
                            $.ajax({
                                url:"./passengers",
                                type:"POST",
                                data:{
                                    passengers: passengers || ''
                                },
                                contentType:"application/x-www-form-urlencoded; charset=UTF-8",
                                dataType:"json",
                                statusCode: {
                                    200: function (response) {
                                        $.ajax({
                                            url:"./contacts",
                                            type:"POST",
                                            data:{
                                                contact: contacts || ''
                                            },
                                            contentType:"application/x-www-form-urlencoded; charset=UTF-8",
                                            statusCode: {
                                                200: function (response) {
                                                    alert(response);
                                                    $('.eachFlight').remove();
                                                    //$('.eachPassenger').remove();
                                                    $('#btnBook').hide();
                                                    $('#btnSell').hide();
                                                    $('.mdltxts').val('');
                                                    $('.mdlBook').modal('hide');

                                                }
                                            }
                                        })
                                    }
                                }
                            })
                        }
                    }
                })

            

            

            



               
            }else{
                alert('First Name, Last Name and one of the contact fields are required.');
            }


           
        });
        
        
    });


    

</script>

</html>